<!DOCTYPE html>
<html>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58227951-1', 'http://hanzratech.in');
  ga('send', 'pageview');

</script>


  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Face Recognition using Python and OpenCV</title>
    <meta name="description" content="Computer Vision and Programming blog
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://bikz05.github.io/2015/02/03/face-recognition-using-opencv.html">
</head>


  <link href='http://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>
<!--
font-family: 'Poiret One', cursive;
-->
<link href='http://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
<!--
font-family: 'Share Tech Mono', ;
-->
<link href='http://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
<!--
font-family: 'Indie Flower', cursive;
-->
<link href='http://fonts.googleapis.com/css?family=Cutive+Mono' rel='stylesheet' type='text/css'>
<!--
font-family: 'Cutive Mono', ;
-->
<link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
<!--
font-family: 'Roboto', sans-serif;
-->


  <body>
    
    <header class="site-header">

  <div class="wrapper">

    <!-- <a class="site-title" href="/">Hanzra Tech</a> -->
    
    <a class="site-title" href="/"><img src="/assets/logo/hanzratech-logo.png" alt="Hanzra Tech" style="width:144px;height:50px"></a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger" style="font-family: 'Indie Flower', cursive;">
        
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	
	  
	  <a class="page-link" href="/contact/">Contact</a>
	  
	
	  
	  <a class="page-link" href="/about/">About</a>
	  
	
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "e95f9855-8c25-452f-a5aa-52401715f9e1", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <h1 class="post-title" style="font-family: 'Indie Flower', cursive;">Face Recognition using Python and OpenCV</h1>
    <p class="post-meta">Feb 3, 2015 • Bikramjot Singh Hanzra
<br>Posted under 
<!--  
 -->
<span class="bikzclick_tag"><a href="/categories/face-detection">face detection</a></span>
<!--  
 -->
<span class="bikzclick_tag"><a href="/categories/face-recognition">face recognition</a></span>
<!--  
 -->
<span class="bikzclick_tag"><a href="/categories/opencv">opencv</a></span>
<!--  
 -->
<span class="bikzclick_tag"><a href="/categories/python">python</a></span> 
</p>
  </header>

  <article class="post-content" style="font-family: 'Roboto', sans-serif;">
    <style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style>
<div class="embed-container"><iframe src="http://www.youtube.com/embed/DP9KX8OaHLw" frameborder="0" allowfullscreen=""></iframe></div>
<p><br /></p>

<p>Recently, I wanted to perform Face Recognition using OpenCV in Python but sadly, I could not find any good resource for the same. So, after a few hours of work, I wrote my own face recognition program using OpenCV and Python. The actual code is less than 40 lines of python code, thanks to the terse syntax of python and now, I am sharing with you what I did.</p>

<p>The whole process can be divided in three major steps -</p>

<ol>
  <li>The first step is to find a good database of faces with multiple images for each induvidual.</li>
  <li>The next step is to detect faces in the database images and use them to train the face recognizer.</li>
  <li>The last step is to test the face recognizer to recognize faces it was trained for.</li>
</ol>

<p>So, let’s get started!</p>

<h1 id="database">Database</h1>

<p>For this tutorial, we will use the <a href="http://vision.ucsd.edu/content/yale-face-database">Yale Face Database</a> that contains 165 grayscale imagesof 15 individuals in gif format, There are 11 images for each individual. In each image, the individual has a different facial expression like happy, sad, normal, surprised, sleepy etc. Indeed, there are 166 images with 12 images for the first individual.</p>

<figure id="figure-1"><a href="/figures/subject01.jpg"><img src="/figures/subject01.jpg" alt="Set of images for individual number 1. Each image has a different facial expression" /></a><figcaption>Figure 1: Set of images for individual number 1. Each image has a different facial expression [<a href="/figures/subject01.jpg">JPG</a>]</figcaption></figure>

<p>We will use this database by using 10 images of the total 11 images of each individual in training our face recognizer and the remaining single image of each individual to test our face recognition algorithm.</p>

<p>The images corresponding to each individual are named like <code>subject&lt;number&gt;.&lt;facial_expression&gt;</code> where <code>number</code> ranges from 01, 02, 03…, 14, 15 and <code>facial_expression</code> is the expression that the individual has in the image.</p>

<p>Here is how the images are named for individual numbered 05 -</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">subject05.centerlight
subject05.glasses
subject05.happy
subject05.leftlight
subject05.noglasses
subject05.normal
subject05.rightlight
subject05.sad
subject05.sleepy
subject05.surprised
subject05.wink</code></pre></div>

<p>Note, there are 11 images for individual numbered 05. Similarly, for individual numbered 01 -</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">subject01.gif
subject01.glasses
subject01.glasses.gif
subject01.happy
subject01.leftlight
subject01.noglasses
subject01.normal
subject01.rightlight
subject01.sad
subject01.sleepy
subject01.surprised
subject01.wink</code></pre></div>

<p>As I had mentioned earlier, there are 12 images for individual number 01.
Out of the 11 images for each individual (12 for the first individual), we will not train the image with the <strong>.sad</strong> extension. We will use these images to test the face recognizer.</p>

<h3 id="implementation">Implementation</h3>

<p>Now, we have an understanding of how our database looks like and it’s time to start programming the face recognition algorithm.</p>

<h4 id="import-the-required-modules">Import the required modules</h4>

<p>The first step is to import the required modules -</p>

<ol>
  <li><code>cv2</code>  - This is the OpenCV module and contains the functions for face detection and recognition.</li>
  <li><code>os</code>  - This module will be used to maneuver with image and directory names. First, we will use this module to extract the image names in the database directory and then from these names we will extract the individual number, which will be used as a label for the face in that image.</li>
  <li><code>Image</code>  - Since, the dataset images are in gif format and as of now, OpenCV does not support gif format, we will use Image module from PIL  to read the image in grayscale format.</li>
  <li><code>numpy</code>  - Our images will be stored in numpy arrays.</li>
</ol>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno">4</span> <span class="kn">import</span> <span class="nn">cv2</span><span class="o">,</span> <span class="nn">os</span>
<span class="lineno">5</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="lineno">6</span> <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span></code></pre></div>

<h4 id="load-the-face-detection-cascade">Load the face detection Cascade</h4>

<p>The first step is to detect the face in each image. Once, we get the region of interest containing the face in the image, we will use it for training the recognizer. For the purpose of face detection, we will use the Haar Cascade provided by OpenCV. The haar cascades that come with OpenCV are located in the <code>/data/haarcascades&gt;</code> directory of your OpenCV installation. We will use <code>haarcascade_frontalface_default.xml</code> for detecting the face. So, we load the cascade using the <code>cv2.CascadeClassifier</code> function which takes the path to the cascade xml file. I have copied the xml file in the current working directory, so I have used the relative path. In case, you cannot locate the haar cascade file on your computer, I have included it in the zip file available for download at the bottom of the post.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno"> 9</span> <span class="n">cascadePath</span> <span class="o">=</span> <span class="s">&quot;haarcascade_frontalface_default.xml&quot;</span>
<span class="lineno">10</span> <span class="n">faceCascade</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CascadeClassifier</span><span class="p">(</span><span class="n">cascadePath</span><span class="p">);</span></code></pre></div>

<h4 id="create-the-face-recognizer-object">Create the Face Recognizer Object</h4>

<p>The next step is creating the face recognizer object. The face recognizer object has functions like <code>FaceRecognizer.train</code> to train the recognizer and <code>FaceRecognizer.predict</code> to recognize a face. OpenCV currently provides 3 face recognizers -</p>

<ol>
  <li>Eigenface Recognizer - <code>createEigenFaceRecognizer()</code></li>
  <li>Fisherface Recognizer  - <code>createFisherFaceRecognizer()</code></li>
  <li>Local Binary Patterns Histograms Face Recognizer - <code>createLBPHFaceRecognizer()</code></li>
</ol>

<p>We will use Local Binary Patterns Histograms Face Recognizer. So, let’s create the face recognizer -</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">recognizer</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">createLBPHFaceRecognizer</span><span class="p">()</span></code></pre></div>

<p><strong>NOTE</strong> - <em>As an aside, if you are interested in knowing how Local Binary Patterns Histograms are created and how they can also be used for texture matching, I would recommend you to go through my blog post on <a href="/2015/05/30/local-binary-patterns.html">Texture Matching using Local Binary Patterns (LBP), OpenCV, scikit-learn and Python</a></em></p>

<h4 id="create-the-function-toprepare-the-training-set">Create the function to prepare the training set</h4>

<p>Now, we will define a function <code>get_images_and_labels</code> that takes the absolute path to the image database as input argument and returns tuple of 2 list, one containing the detected faces and the other containing the corresponding label for that face. For example, if the ith index in the list of faces represents the 5th individual in the database, then the corresponding ith location in the list of labels has value equal to 5.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno">16</span> <span class="k">def</span> <span class="nf">get_images_and_labels</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="lineno">17</span>     <span class="c"># Append all the absolute image paths in a list image_paths</span>
<span class="lineno">18</span>     <span class="c"># We will not read the image with the .sad extension in the training set</span>
<span class="lineno">19</span>     <span class="c"># Rather, we will use them to test our accuracy of the training</span>
<span class="lineno">20</span>     <span class="n">image_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.sad&#39;</span><span class="p">)]</span>
<span class="lineno">21</span>     <span class="c"># images will contains face images</span>
<span class="lineno">22</span>     <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">23</span>     <span class="c"># labels will contains the label that is assigned to the image</span>
<span class="lineno">24</span>     <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">25</span>     <span class="k">for</span> <span class="n">image_path</span> <span class="ow">in</span> <span class="n">image_paths</span><span class="p">:</span>
<span class="lineno">26</span>         <span class="c"># Read the image and convert to grayscale</span>
<span class="lineno">27</span>         <span class="n">image_pil</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s">&#39;L&#39;</span><span class="p">)</span>
<span class="lineno">28</span>         <span class="c"># Convert the image format into numpy array</span>
<span class="lineno">29</span>         <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image_pil</span><span class="p">,</span> <span class="s">&#39;uint8&#39;</span><span class="p">)</span>
<span class="lineno">30</span>         <span class="c"># Get the label of the image</span>
<span class="lineno">31</span>         <span class="n">nbr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">image_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;subject&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="lineno">32</span>         <span class="c"># Detect the face in the image</span>
<span class="lineno">33</span>         <span class="n">faces</span> <span class="o">=</span> <span class="n">faceCascade</span><span class="o">.</span><span class="n">detectMultiScale</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="lineno">34</span>         <span class="c"># If face is detected, append the face to images and the label to labels</span>
<span class="lineno">35</span>         <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
<span class="lineno">36</span>             <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">])</span>
<span class="lineno">37</span>             <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nbr</span><span class="p">)</span>
<span class="lineno">38</span>             <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s">&quot;Adding faces to traning set...&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">[</span><span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">])</span>
<span class="lineno">39</span>             <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="lineno">40</span>     <span class="c"># return the images list and labels list</span>
<span class="lineno">41</span>     <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span></code></pre></div>

<p>In <strong>line 19</strong>, we are appending all the absolute path names of the database images in the list <code>images_path</code>. We, are not appending images with the <strong>.sad</strong> extension, as we will use them to test the accuracy of the recognizer. In <strong>line 21 and 23</strong>, we declare 2 list - images and labels. These are 2 list, that I had discussed in the previous paragraph that will be returned by the recognizer. In the list images, we append the region of interest containing the face and in the list labels, we append the corresponding label for that face. From <strong>line 24 - 38</strong>, we loop around each image to detect the face in it and update our 2 lists. So, in <strong>line 26 - 28</strong> we load the current image in a 2D numpy array image. We cannot read the images directly using cv2.imread because as of now, OpenCV doesn’t support gif format images and unfortunately, our database images are in this format. So, we use the Image module from PIL to read the images in grayscale format and convert them into numpy arrays which are compatible with OpenCV. In** line 30<strong>, from the image name, we extract the individual number. This number will be the label for that face. **In line 32</strong>, we use <code>CascadeClassifier.detectMultiScale</code> to detect faces in the image. Although, in most cases, we need to tune the  <code>CascadeClassifier.detectMultiScale</code> function to correctly recognize faces in the image, but for sake of simplicity, I am leaving this part to the default values. You can refer to <a href="https://realpython.com/blog/python/face-recognition-with-python/">this </a> Real Python post for more insights on this. The <code>CascadeClassifier.detectMultiScale</code> function returns a list of faces. For each face it returns a rectangle in the format <em>(Top-Left x pixel value, Top-Left y pixel value, Width of rectangle, Height of rectangle.)</em>. In <strong>lines 34-38</strong>, we slice the ROI from the image and append it to the list <code>images</code> and the corresponding label in the list <code>labels</code>. Once, we are done with this loop, we return the 2 lists in the form of a tuple.</p>

<h4 id="preparing-the-training-set">Preparing the training set</h4>

<p>We pass the <code>get_images_and_labels</code> function with the <code>path</code> of the database directory. This path has to be the absolute path. This functions returns the features (images) and labels (labels) which will be used to train the face recognizer in the next step.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno">42</span> <span class="c"># Path to the Yale Dataset</span>
<span class="lineno">43</span> <span class="n">path</span> <span class="o">=</span> <span class="s">&#39;yalefaces&#39;</span> 
<span class="lineno">44</span> <span class="c"># The folder yalefaces is in the same folder as this python script</span>
<span class="lineno">45</span> <span class="c"># Call the get_images_and_labels function and get the face images and the </span>
<span class="lineno">46</span> <span class="c"># corresponding labels</span>
<span class="lineno">47</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">get_images_and_labels</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="lineno">48</span> <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span></code></pre></div>

<p>The image below shows that detected faces for each individual. Row 1 contains the face images of individual 1, row 2 contains the face images of individual 2 and so on.</p>

<figure id="figure-2"><a href="/figures/detectedfaces.png"><img src="/figures/detectedfaces.png" alt="The figure shows the detected faces for each individual. Row 1 contains the face images of individual 1, row 2 contains the face images of individual 2 and so on." /></a><figcaption>Figure 2: The figure shows the detected faces for each individual. Row 1 contains the face images of individual 1, row 2 contains the face images of individual 2 and so on. [<a href="/figures/detectedfaces.png">PNG</a>]</figcaption></figure>

<h4 id="perform-the-training">Perform the training</h4>

<p>We perform the training using the FaceRecognizer.train function. It requires 2 arguments, the features which in this case are the images of faces and the corresponding labels assigned to these faces which in this case are the induvidual number that we extracted from the image names.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno">49</span> <span class="c"># Perform the training</span>
<span class="lineno">50</span> <span class="n">recognizer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span></code></pre></div>

<h3 id="testing-the-face-recognizer">Testing the face recognizer</h3>

<p>We will test the results of the recognizer by using the images with .<strong>sad</strong> extension which we had not used earlier. As done in the <code>get_images_and_labels</code> function, we append all the image names with the <strong>.sad</strong> extension in a <code>image_paths</code> list. Then for each image in the list, we read it in grayscale format and detect faces in it. Once, we have the ROI containing the faces, we pass the ROI to the <code>FaceRecognizer.predict</code> function which will assign it a label and it will also tell us how confident it is about the recognition. The label is an integer that is one of the individual numbers we had assigned to the faces earler. This label is stored in <code>nbr_predicted</code>. The more the value of confidence variable is, the less the recognizer has confidence in the recognition. A confidence value of 0.0 is a perfect recognition.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno">52</span> <span class="c"># Append the images with the extension .sad into image_paths</span>
<span class="lineno">53</span> <span class="n">image_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.sad&#39;</span><span class="p">)]</span>
<span class="lineno">54</span> <span class="k">for</span> <span class="n">image_path</span> <span class="ow">in</span> <span class="n">image_paths</span><span class="p">:</span>
<span class="lineno">55</span> <span class="n">predict_image_pil</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s">&#39;L&#39;</span><span class="p">)</span>
<span class="lineno">56</span> <span class="n">predict_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predict_image_pil</span><span class="p">,</span> <span class="s">&#39;uint8&#39;</span><span class="p">)</span>
<span class="lineno">57</span> <span class="n">faces</span> <span class="o">=</span> <span class="n">faceCascade</span><span class="o">.</span><span class="n">detectMultiScale</span><span class="p">(</span><span class="n">predict_image</span><span class="p">)</span>
<span class="lineno">58</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
<span class="lineno">59</span>     <span class="n">nbr_predicted</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="n">recognizer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predict_image</span><span class="p">[</span><span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">])</span>
<span class="lineno">60</span>     <span class="n">nbr_actual</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">image_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;subject&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="lineno">61</span>     <span class="k">if</span> <span class="n">nbr_actual</span> <span class="o">==</span> <span class="n">nbr_predicted</span><span class="p">:</span>
<span class="lineno">62</span>         <span class="k">print</span> <span class="s">&quot;{} is Correctly Recognized with confidence {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nbr_actual</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
<span class="lineno">63</span>     <span class="k">else</span><span class="p">:</span>
<span class="lineno">64</span>         <span class="k">print</span> <span class="s">&quot;{} is Incorrectly Recognized as {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nbr_actual</span><span class="p">,</span> <span class="n">nbr_predicted</span><span class="p">)</span>
<span class="lineno">65</span>     <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s">&quot;Recognizing Face&quot;</span><span class="p">,</span> <span class="n">predict_image</span><span class="p">[</span><span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">])</span>
<span class="lineno">66</span>     <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span></code></pre></div>

<p>From <strong>line 60-66</strong>, we check if the recognition was correct by comparing the predicted label <code>nbr_predicted</code> with the actual label <code>nbr_actual</code>. The label <code>nbr_actual</code> is extracted using the os module and the string operations from the name of the image. We also display the confidence score for each recognition.</p>

<figure id="figure-3"><a href="/figures/facery.png"><img src="/figures/facery.png" alt="Each recognized face with the corresponding confidence." /></a><figcaption>Figure 3: Each recognized face with the corresponding confidence. [<a href="/figures/facery.png">PNG</a>]</figcaption></figure>

<p>In the image above note that, individual number 4 is recognized with a perfect score because <code>subject04.sad</code> and <code>subject04.normal</code> are the same images. From the image above, we can see that our Face Recognizer was able to recognize all the faces correctly.</p>

<h4 id="recap">Recap</h4>

<p>So, in this tutorial we performed the task of face recognition using OpenCV in less than 40 lines of python codes. The code above assigns a label to each image that is to recognized. But, what if the face to be recognized is not even in the database. In that case, the confidence score comes to our rescue. When, the face is not known by the face recognizer, the value of confidence score will be very high and you can use a threshold to ascertain that the face was not recognized.</p>

<p>I hope you liked this blog post, Thank You, <em>Inquilab Zindabad</em></p>

<h3 id="get-the-code-img-classemoji-titlesmile-altsmile-srchttpsassetsgithubcomimagesiconsemojiunicode1f604png-height20-width20-alignabsmiddle-">Get the code <img class="emoji" title=":smile:" alt=":smile:" src="https://assets.github.com/images/icons/emoji/unicode/1f604.png" height="20" width="20" align="absmiddle" /></h3>

<p><span class="bikzclick">
<a href="http://bit.ly/1xpWhdy">Click here to Download the code</a>
</span></p>

<h3 id="resources">Resources</h3>

<ol>
  <li>
    <p>Official OpenCV Documentation - <a href="http://docs.opencv.org/trunk/modules/contrib/doc/facerec/index.html">Click here</a></p>
  </li>
  <li>
    <p>Yale Face Database - <a href="http://vision.ucsd.edu/content/yale-face-database">Click here</a></p>
  </li>
</ol>

  </article>
  
  <center>
<span class='st__large' displayText=''></span>
<span class='st_facebook_large' displayText='Facebook'></span>
<span class='st_googleplus_large' displayText='Google +'></span>
<span class='st_twitter_large' displayText='Tweet'></span>
<span class='st_evernote_large' displayText='Evernote'></span>
<span class='st_tumblr_large' displayText='Tumblr'></span>
<span class='st_baidu_large' displayText='Baidu'></span>
<span class='st_linkedin_large' displayText='LinkedIn'></span>
<span class='st_pinterest_large' displayText='Pinterest'></span>
<span class='st_email_large' displayText='Email'></span>
</center>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'hanzratech'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper" style="font-family: 'Roboto', sans-serif;">

    <!-- <h2 class="footer-heading">Hanzra Tech</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
	<h3>Hanzra Tech</h3>
        <ul class="contact-list">
	  <li>Bikramjot Singh Hanzra</li>
	  <li><a href="mailto:bikz.05@gmail.com">bikz.05@gmail.com</a></li>
          
          <li>
            <a href="https://github.com/bikz05">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">bikz05</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/bikz05">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">bikz05</span>
            </a>
          </li>
          
                  </ul>
      </div>

      <div class="footer-col  footer-col-2" style="text-align: center">
      </div>

      <div class="footer-col  footer-col-3">
	<h3>Subscribe to the mailing list</h3>
	<!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/classic-081711.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{clear:left; font:14px Helvetica,Arial,sans-serif; }
	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//hanzratech.us10.list-manage.com/subscribe/post?u=a52f12efb0d1b0d41d887206e&amp;id=647ba168eb" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<!-- <h2>Subscribe to our mailing list</h2> -->
<!-- <div class="indicates-required"><span class="asterisk">*</span> indicates required</div> -->
<div class="mc-field-group">
	<label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
</label>
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
	<div id="mce-responses" class="clear">
		<div class="response" id="mce-error-response" style="display:none"></div>
		<div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_a52f12efb0d1b0d41d887206e_647ba168eb" tabindex="-1" value=""></div>
    <div class="clear" ><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->

        <!-- <p class="text">Computer Vision and Programming blog
</p> -->
      </div>
    </div>

    <div style="text-align: center">
    Computer Vision and Programming Blog <br>
    Copyright &#169 2014 All rights reserved <a href="/">Hanzra Tech</a>
    </div>
  </div>

</footer>


  </body>

</html>
